---

# Template over files with those variables
- name: Interface | Template over interfaces file
  template: src=interfaces.j2 dest=/etc/network/interfaces owner=root group=root mode=0644

# Template over the wpa supplicant and reboot the host
- name: Interface | Template over wpa_supplicant file; prompt for ssid and psk.
  template: src=wpa_supplicant.conf.j2 dest=/etc/wpa_supplicant/wpa_supplicant.conf  owner=root group=root mode=0644

- name: Rebooting host after hostname change.
  debug: msg="*** Rebooting host after wifi network change ***"
  notify:
    - reboot
    - wait for reboot

- name: reboot
  #command: /sbin/shutdown -r +1
  shell: sleep 2 && shutdown -r now "Ansible updates triggered"
  async: 1
  poll: 0
  ignore_errors: false

- name: wait for reboot
  local_action:
    module: wait_for
      host="{{ inventory_hostname }}"
      port=22
      delay=1
      timeout=300
  sudo: false

- name: Check it rebooted
  shell: ifconfig
  register: ifconfig_output

- debug: msg="Ifconfig output -- {{ ifconfig_output }}"
